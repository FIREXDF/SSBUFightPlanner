<!DOCTYPE html>
<html>
<head>
    <title>FightPlanner</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <div class="downloads-panel" id="downloadsPanel">
        <div class="downloads-header">
            <span>Downloads</span>
            <div class="d-flex align-items-center">
                <span class="me-2" id="downloadCount"></span>
                <button class="btn btn-sm btn-link p-0" id="minimizeDownloads">
                    <i class="bi bi-chevron-down"></i>
                </button>
            </div>
        </div>
        <div class="downloads-list" id="downloadsList">
        </div>
    </div>
    <div class="drag-drop-hint-container">
        <div class="drag-drop-hint">
            <i class="bi bi-cloud-upload"></i>
            <p>Drop files here to import</p>
        </div>
    </div>
    <!-- Top Navigation Tabs -->
    
    <ul class="nav nav-tabs position-relative animate__animated animate__fadeInDown" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="mods-tab" data-bs-toggle="pill" 
                    data-bs-target="#mods" type="button" role="tab">
                <i class="bi bi-grid me-2"></i><span data-i18n="nav.mods">Mods</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="plugins-tab" data-bs-toggle="pill" 
                    data-bs-target="#plugins" type="button" role="tab">
                <i class="bi bi-plug me-2"></i><span data-i18n="nav.plugins">Plugins</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="characters-tab" data-bs-toggle="pill" 
                data-bs-target="#characters" type="button" role="tab">
                <i class="bi bi-people me-2"></i><span data-i18n="nav.characters">Characters</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="settings-tab" data-bs-toggle="pill" 
                    data-bs-target="#settings" type="button" role="tab">
                <i class="bi bi-gear me-2"></i><span data-i18n="nav.settings">Settings</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="gamebanana-tab" data-bs-toggle="pill" 
                    data-bs-target="#gamebanana" type="button" role="tab">
                <i class="bi bi-cloud-download me-2"></i><span>GameBanana</span>
            </button>
        </li>
        <li class="nav-item ms-auto me-3">
            <img 
                src="https://github.com/FIREXDF/SSBUFightPlanner/blob/main/icon.png?raw=true" 
                alt="App Logo" 
                id="appLogo"
                class="app-logo" 
                data-bs-toggle="modal" 
                data-bs-target="#creditsModal"
                style="height: 30px; width: auto; cursor: pointer;"
            >
        </li>
    </ul>

    <!-- Tab Contents -->
    <div class="tab-content h-100" id="mainTabContent">
        <!-- Mods Tab -->
        <div class="tab-pane fade show active h-100" id="mods" role="tabpanel">
            <div class="container-fluid h-100">
                <div class="row h-100">
                    <!-- Mod List (Left Side) -->
                    <div class="col-8 p-3 position-relative col-resizable">
                        <div class="card h-100">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <h5 class="mb-0 me-3" data-i18n="mods.title">Mod List</h5>
                                    <input 
                                        type="text" 
                                        id="modSearchInput" 
                                        class="form-control form-control-sm" 
                                        data-i18n-placeholder="mods.search"
                                        placeholder="Search mods..."
                                        style="width: 200px;"
                                    >
                                </div>
                                <div class="d-flex align-items-center mb-3">
                                    <button class="btn btn-outline-secondary me-2" id="reloadList">
                                        <i class="bi bi-arrow-clockwise"></i>
                                        Reload List
                                    </button>
                                    
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="toggleCategories" data-bs-toggle="dropdown" data-bs-auto-close="false" aria-expanded="false">
                                            <i class="bi bi-funnel"></i>
                                            Categories
                                        </button>
                                        <div class="dropdown-menu p-2" id="categoryFilters" data-bs-popper="none">
                                            <h6 class="dropdown-header">Filter by category</h6>
                                            <div class="dropdown-divider"></div>
                                            <button class="dropdown-item" data-category="Fighter">Fighter</button>
                                            <button class="dropdown-item" data-category="Movesets">Movesets</button>
                                            <button class="dropdown-item" data-category="Stages">Stages</button>
                                            <button class="dropdown-item" data-category="Effects">Effects</button>
                                            <button class="dropdown-item" data-category="Final Smash">Final Smash</button>
                                            <button class="dropdown-item" data-category="UI">UI</button>
                                            <button class="dropdown-item" data-category="Param">Param</button>
                                            <button class="dropdown-item" data-category="Audio">Audio</button>
                                            <button class="dropdown-item" data-category="Other/Misc">Other/Misc</button>
                                            <div class="dropdown-divider"></div>
                                            <button class="dropdown-item text-danger" id="clearCategoryFilters">
                                                <i class="bi bi-x-circle"></i> Clear Filters
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="mod-list overflow-auto" id="modList" style="height: calc(100vh - 160px);">
                                </div>
                            </div>
                        </div>
                    </div>
                
                    
                    <!-- Mod Details and Preview (Right Side) -->
                    <div class="col-4 p-3 d-flex flex-column">
                        <!-- Mod Preview -->
                        <div class="card flex-grow-1 mb-3">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Mod Details</h5>
                                    <button class="btn btn-sm btn-outline-primary" id="editModInfo" style="display: none;">
                                        <i class="bi bi-pencil-square"></i> Edit Info
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mod-preview mb-3">
                                    <img id="modImage" src="" alt="No image" class="img-fluid rounded">
                                </div>
                                <div class="mod-metadata overflow-auto" id="modMetadata" style="max-height: 340px;">
                                    <div class="metadata-content">
                                        Select a mod to view details
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Floating Action Buttons -->
                <div class="floating-actions">
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary rounded-start" id="installMod" title="Install Mod">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                        <button class="btn btn-secondary" id="openFolder" title="Open Mods Folder">
                            <i class="bi bi-folder"></i>
                        </button>
                        <button id="gameBananaDownloadBtn" class="btn btn-success" title="Download from GameBanana">
                            <i class="bi bi-download"></i>
                        </button>
                        <button id="launchGame" class="btn btn-info rounded-end" title="Launch Game" style="margin-left: 0;">
                            <i class="bi bi-play-fill"></i>
                        </button>
                        <button class="btn btn-secondary" id="createFpp" title="Create FPP Package">
                            <i class="bi bi-file-earmark-zip"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- GameBanana Tab -->
        <div class="tab-pane fade h-100" id="gamebanana" role="tabpanel">
            <div class="container-fluid h-100">
                <div class="row h-100">
                    <!-- Mods List (Left Side) -->
                    <div class="col-9 p-3 overflow-auto">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">Mods</h5>
                            </div>
                            <div class="card-body">
                                <div id="gamebananaModsList" class="d-flex flex-wrap gap-3">
                                    <!-- Mod cards will be dynamically populated here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Categories (Right Side) -->
                    <div class="col-3 p-3">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">Categories</h5>
                            </div>
                            <div class="card-body">
                                <div id="gamebananaCategories" class="d-flex flex-column gap-2">
                                    <!-- Category buttons -->
                                    <button class="btn btn-outline-primary" data-category="Featured">Featured</button>
                                    <button class="btn btn-outline-primary" data-category="Skins">Skins</button>
                                    <button class="btn btn-outline-primary" data-category="Movesets">Movesets</button>
                                    <button class="btn btn-outline-primary" data-category="Stages">Stages</button>
                                    <button class="btn btn-outline-primary" data-category="Effects">Effects</button>
                                    <button class="btn btn-outline-primary" data-category="Audio">Audio</button>
                                    <button class="btn btn-outline-primary" data-category="Other/Misc">Other/Misc</button>
                                    <button class="btn btn-outline-primary" data-category="UI">UI</button>
                                    <button class="btn btn-outline-primary" data-category="Final Smash">Final Smash</button>
                                    <button class="btn btn-outline-primary" data-category="Skyline">Skyline</button>
                                    <button class="btn btn-outline-primary" data-category="Gameplay">Gameplay</button>
                                    <button class="btn btn-outline-primary" data-category="Animation">Animation</button>
                                    <button class="btn btn-outline-primary" data-category="Mod Packs">Mod Packs</button>
                                    <button class="btn btn-outline-primary" data-category="Music Packs">Music Packs</button>
                                    <button class="btn btn-outline-primary" data-category="Tools">Tools</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Plugins Tab -->
        <div class="tab-pane fade h-100" id="plugins" role="tabpanel">
            <div class="container-fluid h-100">
                <div class="row h-100">
                    <!-- Plugin List (Left Side) -->
                    <div class="col-12 p-3 position-relative">
                        <div class="card h-100 animate__animated animate__fadeInLeft">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <h5 class="mb-0 me-3" data-i18n="plugins.title">Plugin List</h5>
                                </div>
                                <div class="d-flex align-items-center">
                                    <button class="btn btn-sm btn-outline-secondary" id="reloadPluginsList">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="plugin-list overflow-auto" id="pluginList" style="height: calc(100vh - 160px);">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Floating Action Button for Plugins -->
                <div class="floating-actions animate__animated animate__fadeInUp">
                    <div class="btn-group">
                        <button class="btn btn-secondary" id="openPluginsFolderButton" title="Open Plugins Folder">
                            <i class="bi bi-folder"></i>
                        </button>
                        <button class="btn btn-primary" id="installPlugin" title="Install Plugin">
                            <i class="bi bi-plus-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Settings Tab -->
        <div class="tab-pane fade" id="settings" role="tabpanel">
            <div class="container-fluid p-4 h-100">
                <div class="card h-100 animate__animated animate__fadeIn">
                    <div class="card-header">
                        <h5 class="mb-0">Settings</h5>
                    </div>                     
                    <div class="card-body overflow-auto" style="max-height: calc(100vh - 160px);">
                        <!-- Settings Tabs Navigation -->
                        <ul class="nav nav-pills mb-3" id="settingsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="paths-tab" data-bs-toggle="pill" data-bs-target="#paths-content" type="button" role="tab">
                                    <i class="bi bi-folder me-2"></i>Setup
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="appearance-tab" data-bs-toggle="pill" data-bs-target="#appearance-content" type="button" role="tab">
                                    <i class="bi bi-palette me-2" ></i>Appearance
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="integration-tab" data-bs-toggle="pill" data-bs-target="#integration-content" type="button" role="tab">
                                    <i class="bi bi-plug me-2" ></i>Features
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="emulator-tab" data-bs-toggle="pill" data-bs-target="#emulator-content" type="button" role="tab">
                                    <i class="bi bi-controller me-2" ></i>Emulator
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="logs-tab" data-bs-toggle="pill" data-bs-target="#logs-content" type="button" role="tab">
                                    <i class="bi bi-journal-text me-2"></i>Logs
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="feedback-tab" data-bs-toggle="pill" data-bs-target="#feedback-content" type="button" role="tab">
                                    <i class="bi bi-chat-dots me-2"></i>Feedback
                                </button>
                            </li>
                        </ul>

                        <!-- Settings Tabs Content -->
                        <div class="tab-content" id="settingsTabsContent">
                            <!-- Paths Tab -->
                            <div class="tab-pane fade show active" id="paths-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3" data-i18n="settings.paths.title">Directory Settings</h6>
                                    <label class="form-label" data-i18n="settings.paths.modsDir">Mods Directory</label>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="modsPath" readonly>
                                        <button class="btn btn-outline-primary" id="selectModsFolder">
                                            <i class="bi bi-folder2-open"></i>
                                        </button>
                                    </div>
                                    
                                    <label class="form-label" data-i18n="settings.paths.pluginsDir">Plugins Directory</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="pluginsPath" readonly>
                                        <button class="btn btn-outline-primary" id="selectPluginsFolder">
                                            <i class="bi bi-folder2-open"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Appearance Tab -->
                            <div class="tab-pane fade" id="appearance-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3" data-i18n="settings.theme.title">Theme Settings</h6>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                                        <label class="form-check-label" for="darkModeToggle" data-i18n="settings.theme.dark">Dark Mode</label>
                                    </div>

                                    <label class="form-label" data-i18n="settings.theme.css">Custom CSS File</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="customCssPath" readonly>
                                        <button class="btn btn-outline-primary" id="selectCustomCssFile">
                                            <i class="bi bi-folder2-open"></i>
                                        </button>
                                        <button class="btn btn-outline-danger" id="removeCustomCssFile">
                                            <i class="bi bi-x-circle"></i>
                                        </button>
                                    </div>
                                    <small class="textmuted" data-i18n="settings.theme.csstext">Select the custom CSS file for styling (Restart needed)</small>
                                </div>

                                <div class="mb-3">
                                    <h6 class="mb-3">Language</h6>
                                    <select class="form-select" id="languageSelect">
                                        <option value="en">English</option>
                                        <option value="es">Español</option>
                                        <option value="fr">Français</option>
                                        <option value="zh-TW">繁體中文</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Integration Tab -->
                            <div class="tab-pane fade" id="integration-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3">Features</h6>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="protocolConfirmToggle">
                                        <label class="form-check-label" for="protocolConfirmToggle">Skip Protocol Confirmation</label>
                                        <small class="form-text textmuted d-block">Skip the confirmation dialog when opening FightPlanner links</small>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="conflictCheckToggle">
                                        <label class="form-check-label" for="conflictCheckToggle">Enable Conflict Check (Takes longer to load mods)</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="discordRpcToggle">
                                        <label class="form-check-label" for="discordRpcToggle">Enable Discord RPC</label>
                                    </div>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="legacyModDiscoveryToggle">
                                        <label class="form-check-label" for="legacyModDiscoveryToggle">Legacy mod discovery (faster)</label>
                                        <small class="form-text textmuted d-block">Use dot-prefixed folders for disabled mods instead of a separate directory.</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="volumeControl" class="form-label">Finish Sound Volume</label>
                                        <input type="range" class="form-range" id="volumeControl" min="0" max="100" step="1">
                                        <small class="textmuted">Adjust the volume for finish download sound</small>
                                    </div>
                                    <div class="mb-3">
                                        <button class="btn btn-danger" id="clearTempFiles">
                                            <i class="bi bi-trash me-2"></i>Clear Temporary Files
                                        </button>
                                        <small class="form-text textmuted d-block">Remove all temporary files to free up space</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Emulator Tab -->
                            <div class="tab-pane fade" id="emulator-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3">Emulator Settings</h6>
                                    
                                    <!-- Emulator Selection -->
                                    <div class="mb-3">
                                        <label class="form-label">Select Emulator</label>
                                        <select class="form-select" id="emulatorSelect">
                                            <option value="">Select an emulator...</option>
                                            <option value="yuzu">yuzu (any fork of yuzu should work with no problem)</option>
                                            <option value="ryujinx">Ryujinx</option>
                                        </select>
                                    </div>

                                    <!-- Emulator Path -->
                                    <div class="mb-3">
                                        <label class="form-label">Emulator Path</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="emulatorPath" readonly>
                                            <button class="btn btn-outline-primary" id="selectEmulatorPath">
                                                <i class="bi bi-folder2-open"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Game Path -->
                                    <div class="mb-3">
                                        <label class="form-label">Game Path</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="gamePath" readonly>
                                            <button class="btn btn-outline-primary" id="selectGamePath">
                                                <i class="bi bi-folder2-open"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Yuzu Fullscreen Option -->
                                    <div class="mb-3" id="yuzuOptions" style="display: none;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="yuzuFullscreen">
                                            <label class="form-check-label" for="yuzuFullscreen">
                                                Launch in Fullscreen
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Feedback Tab -->
                            <div class="tab-pane fade" id="feedback-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3">Suggestions & Support</h6>
                                    <p>Got a suggestion for FightPlanner? Want a feature to be added? Let me know!</p>
                                    <a href="https://forms.gle/ZoypQYxyMw57poXs8" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                                        <i class="bi bi-send me-2"></i>Submit Feedback
                                    </a>
                                    
                                    <hr class="my-4">
                                    
                                    <p>FightPlanner dev searching for people to test Early Access ! Go check it out</p>
                                    <a href="https://forms.gle/TRkqw8g5hDaPXoc59" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                                        <i class="bi bi-send me-2"></i>Apply for Early Access
                                    </a>

                                    <hr class="my-4">

                                    <p>FightPlanner got an official discord server ! Come join it !</p>
                                    <a href="https://discord.gg/2zT5Rg46bG" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                                        <i class="bi bi-discord me-2"></i>Join the official discord server !
                                    </a>
                                </div>
                            </div>

                            <!-- Add this new tab content -->
                            <div class="tab-pane fade" id="logs-content" role="tabpanel">
                                <div class="mb-4">
                                    <h6 class="mb-3">Application Logs</h6>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <button class="btn btn-primary" id="openCurrentLog">
                                            <i class="bi bi-file-text me-2"></i>Open Current Log
                                        </button>
                                        <button class="btn btn-outline-secondary" id="openLogsFolder">
                                            <i class="bi bi-folder me-2"></i>Open Logs Folder
                                        </button>
                                    </div>
                                    <div class="log-preview card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span>Console Output</span>
                                            <div>
                                                <button class="btn btn-sm btn-outline-secondary" id="clearLogs">
                                                    <i class="bi bi-trash"></i> Clear
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" id="refreshLogs">
                                                    <i class="bi bi-arrow-clockwise"></i> Refresh
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body p-2">
                                            <pre id="logContent" class="log-content" style="max-height: 400px; overflow-y: auto;">Loading logs...</pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Replace the characters tab content -->
        <div class="tab-pane fade" id="characters" role="tabpanel">
            <div class="container-fluid p-3">
                <div class="row">
                    <div class="col-12">
                        <div class="card animate__animated animate__fadeIn">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Character Usage</h5>
                                <button class="btn btn-sm btn-outline-primary" id="refreshCharacters">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="characterSlotsList" class="character-slots-list">
                                    <!-- Content will be populated by CharacterScanner -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="dropdown-menu" id="contextMenu">
        <a class="dropdown-item" href="#" id="toggleMod">
            <i class="bi bi-toggle-on me-2"></i>Enable/Disable
        </a>
        <a class="dropdown-item" href="#" id="openModFolder">
            <i class="bi bi-folder me-2"></i>Open Folder
        </a>
        <a class="dropdown-item" href="#" id="renameMod">
            <i class="bi bi-pencil me-2"></i>Rename
        </a>
        <a class="dropdown-item" href="#" id="changeSlots">
            <i class="bi bi-arrow-left-right me-2"></i>Change Character Slot
        </a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item text-danger" href="#" id="uninstallMod">
            <i class="bi bi-trash me-2"></i>Uninstall
        </a>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="../js/uiController.js" type="module"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {


            const dontShowAgain = localStorage.getItem('dontShowEarlyAccessModal');
            if (!dontShowAgain) {
                const earlyAccessModal = new bootstrap.Modal(document.getElementById('earlyAccessModal'));
                earlyAccessModal.show();
            }

            document.getElementById('dontShowAgain').addEventListener('change', (event) => {
                if (event.target.checked) {
                    localStorage.setItem('dontShowEarlyAccessModal', 'true');
                } else {
                    localStorage.removeItem('dontShowEarlyAccessModal');
                }
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Vérifier si c'est le 1er avril
            const today = new Date();
            const isAprilFools = today.getMonth() === 3 && today.getDate() === 1;
            
            if (isAprilFools) {
                // Change logo in navbar
                const appLogo = document.querySelector('#appLogo');
                if (appLogo) {
                    appLogo.src = "https://files.gamebanana.com/bitpit/feetplanner.png";
                }
                
                // Change logo and text in credits
                const creditsLogo = document.querySelector('.credits-logo');
                const creditsTitle = document.querySelector('#creditsModal .display-4');
                const creditsSubtitle = document.querySelector('#creditsModal .lead');
                
                if (creditsLogo) {
                    creditsLogo.src = "https://files.gamebanana.com/bitpit/feetplanner.png";
                }
                
                if (creditsTitle) {
                    creditsTitle.textContent = 'FeetPlanner';
                }
                
                if (creditsSubtitle) {
                    creditsSubtitle.textContent = 'Feet Manager for SSBU';
                }
            }

            // Konami code existant
            const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
            let konamiIndex = 0;

            document.addEventListener('keydown', (e) => {
                if (e.key === konamiCode[konamiIndex]) {
                    konamiIndex++;
                    
                    if (konamiIndex === konamiCode.length) {
                        konamiIndex = 0;
                        
                        // Change logo in navbar
                        const appLogo = document.querySelector('#appLogo');
                        if (appLogo) {
                            appLogo.src = "https://files.gamebanana.com/bitpit/feetplanner.png";
                        }
                        
                        // Change logo and text in credits
                        const creditsLogo = document.querySelector('.credits-logo');
                        const creditsTitle = document.querySelector('#creditsModal .display-4');
                        const creditsSubtitle = document.querySelector('#creditsModal .lead');
                        
                        if (creditsLogo) {
                            creditsLogo.src = "https://files.gamebanana.com/bitpit/feetplanner.png";
                        }
                        
                        if (creditsTitle) {
                            creditsTitle.textContent = 'FeetPlanner';
                        }
                        
                        if (creditsSubtitle) {
                            creditsSubtitle.textContent = 'Feet Manager for SSBU';
                        }
                    }
                } else {
                    konamiIndex = 0;
                }
            });
        });
    </script>

    <!-- Credits Modal -->
<div class="modal fade" id="creditsModal" tabindex="-1" aria-labelledby="creditsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content credits-dark">
            <div class="modal-body d-flex align-items-center position-relative">
                <button type="button" class="credits-close-btn" data-bs-dismiss="modal" aria-label="Close">
                    <i class="bi bi-x-lg"></i>
                </button>
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <!-- App Info Section -->
                            <div class="text-center mb-5">
                                <a href="https://gamebanana.com/tools/17950" target="_blank" rel="noopener noreferrer">
                                    <img src="https://github.com/FIREXDF/SSBUFightPlanner/blob/main/icon.png?raw=true" 
                                         alt="App Logo" 
                                         class="credits-logo mb-4 animate__animated animate__fadeIn"
                                         style="max-height: 150px;">
                                </a>
                                <h1 class="display-4 text-white mb-2 animate__animated animate__fadeInUp">FightPlanner</h1>
                                <p class="lead text-white-50 animate__animated animate__fadeInUp">Mod Manager for SSBU</p>
                                <div class="version-badge animate__animated animate__fadeInUp" id="appVersionBadge">Loading version...</div>
                            </div>

                            <!-- Core Team Section -->
                            <div class="team-section mb-5 animate__animated animate__fadeInUp">
                                <h3 class="text-white text-center mb-4">Core Team</h3>
                                <div class="credits-grid">
                                    <div class="credits-member">
                                        <div class="member-role">Developer</div>
                                        <div class="member-name">FIREXDF</div>
                                    </div>
                                    <div class="credits-member">
                                        <div class="member-role">Designer of the logo</div>
                                        <div class="member-name">FloweyGaming</div>
                                    </div>
                                    <div class="credits-member">
                                        <div class="member-role">Real Hardware Helper</div>
                                        <div class="member-name">Mario45</div>
                                    </div>
                                    <div class="credits-member">
                                        <div class="member-role">Real Hardware Helper</div>
                                        <div class="member-name">Toni</div>
                                    </div>
                                    <div class="credits-member">
                                        <div class="member-role">Real Hardware Helper</div>
                                        <div class="member-name">Sam</div>
                                    </div>
                                    <div class="credits-member">
                                        <div class="member-role">Sound Maker</div>
                                        <div class="member-name">Cwitt</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Testing Team Section -->
                            <div class="testing-section mb-5 animate__animated animate__fadeInUp">
                                <h3 class="text-white text-center mb-4">Testing Team</h3>
                                <div class="tester-tags">
                                    <span class="tester-tag">Chichiboo</span>
                                    <span class="tester-tag">Jpgmafia</span>
                                    <span class="tester-tag">ElDusst</span>
                                    <span class="tester-tag">Squiori</span>
                                    <span class="tester-tag">Oliver Tzeng</span>
                                    <span class="tester-tag">Masne</span>
                                    <span class="tester-tag">Sam</span>
                                    <span class="tester-tag">MrMiri</span>
                                    <span class="tester-tag">Toni</span>
                                    <span class="tester-tag">Gamma</span>
                                    <span class="tester-tag">Moxort</span>
                                    <span class="tester-tag">I Am The Alien From Guam</span>
                                    <span class="tester-tag">RestGhost</span>
                                    <span class="tester-tag">Cwitt</span>
                                    <span class="tester-tag">Izayuh</span>
                                    <span class="tester-tag">Lava</span>
                                    <span class="tester-tag">Kerosci</span>
                                    <span class="tester-tag">Willy. B</span>
                                    <span class="tester-tag">Picassoh</span>
                                    <span class="tester-tag">Dantepicachu</span>
                                    <span class="tester-tag">J-Rat15</span>
                                </div>
                            </div>

                            <!-- Technologies Section -->
                            <div class="tech-section mb-5 animate__animated animate__fadeInUp">
                                <h3 class="text-white text-center mb-4">Built With</h3>
                                <div class="tech-stack">
                                    <div class="tech-item">
                                        <i class="bi bi-code-square"></i>
                                        <span>Electron</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Copyright Notice -->
                            <div class="text-center mt-5">
                                <small class="text-white-50">All rights to the logo of SSBU are owned by Nintendo™. We don't own it.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Restart Needed Modal -->
    <div class="modal fade" id="restartNeededModal" tabindex="-1" aria-labelledby="restartNeededModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="restartNeededModalLabel">Restart Needed</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    A restart is needed for changes to take effect.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Early Access Modal -->
    <div class="modal fade" id="earlyAccessModal" tabindex="-1" aria-labelledby="earlyAccessModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="earlyAccessModalLabel">Early Access Testing</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>We are searching for people to test the early access version of FightPlanner. These versions should help make the release version more stable and with fewer errors.</p>
                    <a href="https://forms.gle/TRkqw8g5hDaPXoc59" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                        <i class="bi bi-send me-2"></i>Apply for Early Access
                    </a>
                    <div class="form-check mt-3">
                        <input class="form-check-input" type="checkbox" id="dontShowAgain">
                        <label class="form-check-label" for="dontShowAgain">
                            Don't show this message again
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="toastContainer"></div>
    </div>

    <!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel" data-i18n="modals.confirm.title">Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" data-i18n="modals.confirm.uninstall">
                Are you sure you want to uninstall this mod?
            </div>
            <div class="modal-footer">                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="modals.confirm.cancel">Cancel</button>                <button type="button" class="btn btn-primary" id="confirmUninstallBtn" data-i18n="modals.confirm.confirm">Yes, Uninstall</button>            </div>        </div>    </div>
</div>

<!-- Change Slots Modal -->
<div class="modal fade" id="changeSlotsModal" tabindex="-1" aria-labelledby="changeSlotsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="changeSlotsModalLabel">Change Character Slots</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="currentSlotsInfo"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmChangeSlots">Change Slots</button>
            </div>
        </div>
    </div>
</div>

<!-- Select Mods Modal -->
<div class="modal fade" id="selectModsModal" tabindex="-1" aria-labelledby="selectModsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="selectModsModalLabel">Select Mods to Change Slots</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Select the mods you want to change slots for:</p>
                <div class="list-group">
                    <!-- Mod list will be dynamically inserted here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmSelectMods">Confirm</button>
            </div>
        </div>
    </div>
</div>

<!-- FPP Creation Modal -->
<div class="modal fade" id="createFppModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create FightPlanner Package</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Package Name</label>
                    <input type="text" class="form-control" id="fppName" placeholder="MyPackage">
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Select Content to Include:</label>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="selectAllMods">
                        <label class="form-check-label" for="selectAllMods">
                            Select All Mods (can be slow and buggy if you got more of 50 mods.)
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="selectAllPlugins">
                        <label class="form-check-label" for="selectAllPlugins">
                            Select All Plugins
                        </label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6>Mods</h6>
                        <div class="mb-2">
                            <input type="text" class="form-control form-control-sm" id="fppModSearch" placeholder="Search mods...">
                        </div>
                        <div class="list-group" id="fppModsList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Mods will be dynamically added here -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Plugins</h6>
                        <div class="mb-2">
                            <input type="text" class="form-control form-control-sm" id="fppPluginSearch" placeholder="Search plugins...">
                        </div>
                        <div class="list-group" id="fppPluginsList" style="max-height: 300px; overflow-y: auto;">
                            <!-- Plugins will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="createFppBtn">Create Package</button>
            </div>
        </div>
    </div>
</div>

<style>
    .slot-group {
        position: relative;
    }
    .slot-group.removed .overlay {
        display: block;
    }
    .overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 0, 0, 0.5);
        z-index: 1;
    }
</style>

<!-- Update the loading overlay with close button -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
        <div id="loadingAnimationContainer" class="loading-animation-crop">
            <lottie-player
                src="https://cdn.lottielab.com/l/BgbVdxvgksWEgv.json"
                background="transparent"
                speed="2"
                loop
                autoplay
                style="width: 200px; height: 200px;"
            ></lottie-player>
        </div>
        <div id="loadingMessage" class="loading-message loading-message-fade"></div>
        <button id="cancelDownloadBtn" class="btn btn-danger mt-3" style="display: none;">
            <i class="bi bi-x-circle me-2"></i>Cancel Download
        </button>
    </div>
</div>

<!-- Add this before the closing body tag -->
<div class="modal fade" id="characterImageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="characterImageModalLabel"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="characterImageLarge" src="" alt="" style="max-width: 100%; height: auto;">
            </div>
        </div>
    </div>
</div>

<div id="modPreviewTooltip" class="mod-preview-tooltip">
    <img src="" alt="Mod Preview">
</div>

<!-- Add this modal before the closing body tag -->
<div class="modal fade" id="editModInfoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Mod Info</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="modInfoForm">
                    <div class="mb-3">
                        <label class="form-label">Display Name</label>
                        <input type="text" class="form-control" name="display_name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Authors</label>
                        <input type="text" class="form-control" name="authors" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" rows="5" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Version</label>
                        <input type="text" class="form-control" name="version" pattern="^\d+\.\d+\.\d+$|^$">
                        <small class="form-text text-muted">Format: x.y.z (e.g., 1.0.0) - Optional</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" name="category" required>
                            <option value="Fighter">Fighter</option>
                            <option value="Movesets">Movesets</option>
                            <option value="Stages">Stages</option>
                            <option value="Effects">Effects</option>
                            <option value="Final Smash">Final Smash</option>
                            <option value="UI">UI</option>
                            <option value="Param">Param</option>
                            <option value="Audio">Audio</option>
                            <option value="Other/Misc">Other/Misc</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">GameBanana URL</label>
                        <input type="url" class="form-control" name="url">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveModInfo">Save Changes</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
